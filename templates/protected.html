<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Protected Page</title>
  <style>body{font-family:Arial, sans-serif; max-width:700px; margin:30px auto;}</style>
</head>
<body>
  <h1>You got it</h1>
  <p>Welcome, {{ user }}!</p>
  {% if session.get('user') %}
    <p>Your role: {{ session.get('role') or 'user' }}</p>
  {% endif %}
  {% if session.get('role') == 'admin' %}
    <p><a href="{{ url_for('admin') }}">Admin: manage users</a></p>
  {% endif %}
    <p><a href="{{ url_for('requests_view') }}">Pending requests</a> | <a href="{{ url_for('notifications_view') }}">Notifications</a></p>
  <h2>Request to upload a file</h2>
  <form method="post" action="{{ url_for('upload') }}" enctype="multipart/form-data">
    <input type="file" name="file">
    <button type="submit">Request Upload</button>
  </form>

  <h2>Your files</h2>
  {% if files %}
    <ul>
      {% for f in files %}
        <li>{{ f[2] }} — uploaded at {{ f[4] }} — owned by {{ f[1] }}
          <form method="post" action="{{ url_for('request_download', file_id=f[0]) }}" style="display:inline">
            <button type="submit">Request Download</button>
          </form>
          {% if session.get('role') == 'admin' %}
            <!-- admin can also request download like anyone else -->
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No files uploaded yet.</p>
  {% endif %}

  <p><a href="{{ url_for('logout') }}">Logout</a></p>
</body>
</html>
